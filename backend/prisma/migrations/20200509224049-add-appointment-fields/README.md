# Migration `20200509224049-add-appointment-fields`

This migration has been generated by etahoon at 5/9/2020, 10:40:49 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."AppointmentField" (
"appointmentId" text  NOT NULL ,"fieldId" text  NOT NULL ,"id" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Appointment" ALTER COLUMN "glucoseLevel" SET DEFAULT -1,
ALTER COLUMN "height" SET DEFAULT -1,
ALTER COLUMN "pulse" SET DEFAULT -1,
ALTER COLUMN "temp" SET DEFAULT -1,
ALTER COLUMN "weight" SET DEFAULT -1;

CREATE UNIQUE INDEX "appointment_field_unique_constraint" ON "public"."AppointmentField"("appointmentId","fieldId")

ALTER TABLE "public"."AppointmentField" ADD FOREIGN KEY ("appointmentId")REFERENCES "public"."Appointment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentField" ADD FOREIGN KEY ("fieldId")REFERENCES "public"."Field"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200508221019-rename-field-to-field..20200509224049-add-appointment-fields
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -56,44 +56,56 @@
   sex          Sex
 }
 model Appointment {
-  id              String          @default(uuid()) @id
-  date            DateTime        @default(now()) @unique
-  type            AppointmentType
-  patient         Patient         @relation(fields: [patientId], references: [id])
-  patientId       String
-  specialty       Specialty
-  doctor          User            @relation(fields: [doctorId], references: [id])
-  doctorId        String
-  labs            String?         @default("[]")
-  complain        String?         @default("")
-  signs           String?         @default("")
-  diagnosis       String?         @default("")
-  treatment       String?         @default("")
-  recommendations String?         @default("")
-  weight          Float?          @default(-1)
-  height          Float?          @default(-1)
-  pulse           Float?          @default(-1)
-  temp            Float?          @default(-1)
-  glucoseLevel    Float?          @default(-1)
-  archived        Boolean         @default(false)
+  id               String             @default(uuid()) @id
+  date             DateTime           @default(now()) @unique
+  type             AppointmentType
+  patient          Patient            @relation(fields: [patientId], references: [id])
+  patientId        String
+  specialty        Specialty
+  doctor           User               @relation(fields: [doctorId], references: [id])
+  doctorId         String
+  labs             String?            @default("[]")
+  complain         String?            @default("")
+  signs            String?            @default("")
+  diagnosis        String?            @default("")
+  treatment        String?            @default("")
+  recommendations  String?            @default("")
+  weight           Float?             @default(-1)
+  height           Float?             @default(-1)
+  pulse            Float?             @default(-1)
+  temp             Float?             @default(-1)
+  glucoseLevel     Float?             @default(-1)
+  archived         Boolean            @default(false)
+  AppointmentField AppointmentField[]
 }
+model AppointmentField {
+  id            String      @default(uuid()) @id
+  appointment   Appointment @relation(fields: [appointmentId], references: [id])
+  appointmentId String
+  field         Field       @relation(fields: [fieldId], references: [id])
+  fieldId       String
+
+  @@unique([appointmentId, fieldId], name: "appointment_field_unique_constraint")
+}
+
 model FieldGroup {
   id     String  @default(uuid()) @id
   name   String
   order  Int     @unique
   fields Field[]
 }
 model Field {
-  id           String      @default(uuid()) @id
-  name         String
-  order        Int
-  type         FieldType
-  required     Boolean
-  fieldGroup   FieldGroup? @relation(fields: [fieldGroupId], references: [id])
-  fieldGroupId String?
+  id               String             @default(uuid()) @id
+  name             String
+  order            Int
+  type             FieldType
+  required         Boolean
+  fieldGroup       FieldGroup?        @relation(fields: [fieldGroupId], references: [id])
+  fieldGroupId     String?
+  AppointmentField AppointmentField[]
   @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
 }
```


