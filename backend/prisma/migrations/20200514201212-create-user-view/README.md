# Migration `20200514201212-create-user-view`

This migration has been generated by etahoon at 5/14/2020, 8:12:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."FieldGroup.order"

CREATE TABLE "public"."View" (
"default" boolean  NOT NULL DEFAULT false,"id" text  NOT NULL ,"name" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Appointment" ALTER COLUMN "glucoseLevel" SET DEFAULT -1,
ALTER COLUMN "height" SET DEFAULT -1,
ALTER COLUMN "pulse" SET DEFAULT -1,
ALTER COLUMN "temp" SET DEFAULT -1,
ALTER COLUMN "weight" SET DEFAULT -1;

ALTER TABLE "public"."FieldGroup" ADD COLUMN "viewId" text  NOT NULL ;

CREATE UNIQUE INDEX "order_viewId_unique_constraint" ON "public"."FieldGroup"("order","viewId")

ALTER TABLE "public"."View" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."FieldGroup" ADD FOREIGN KEY ("viewId")REFERENCES "public"."View"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER INDEX "public"."appointment_field_unique_constraint" RENAME TO "appointment_fieldId_unique_constraint"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200509225810-add-value-to-appointement-field..20200514201212-create-user-view
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -43,8 +43,9 @@
   email          String        @unique
   password       String
   organizationId String
   Appointment    Appointment[]
+  View           View[]
 }
 model Patient {
   id           String                @default(uuid()) @id
@@ -79,24 +80,26 @@
   archived        Boolean            @default(false)
   data            AppointmentField[]
 }
-model AppointmentField {
-  id            String      @default(uuid()) @id
-  appointment   Appointment @relation(fields: [appointmentId], references: [id])
-  appointmentId String
-  field         Field       @relation(fields: [fieldId], references: [id])
-  fieldId       String
-  value         String
-
-  @@unique([appointmentId, fieldId], name: "appointment_field_unique_constraint")
+model View {
+  id         String       @default(uuid()) @id
+  name       String
+  default    Boolean      @default(false)
+  user       User         @relation(fields: [userId], references: [id])
+  userId     String
+  FieldGroup FieldGroup[]
 }
 model FieldGroup {
   id     String  @default(uuid()) @id
   name   String
-  order  Int     @unique
+  order  Int
+  view   View    @relation(fields: [viewId], references: [id])
+  viewId String
   fields Field[]
+
+  @@unique([order, viewId], name: "order_viewId_unique_constraint")
 }
 model Field {
   id               String             @default(uuid()) @id
@@ -108,5 +111,16 @@
   fieldGroupId     String?
   AppointmentField AppointmentField[]
   @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
+}
+
+model AppointmentField {
+  id            String      @default(uuid()) @id
+  appointment   Appointment @relation(fields: [appointmentId], references: [id])
+  appointmentId String
+  field         Field       @relation(fields: [fieldId], references: [id])
+  fieldId       String
+  value         String
+
+  @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
 }
```


