# Migration `20210403190453-appointment-files`

This migration has been generated by etahoon at 4/3/2021, 9:04:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."ImageFile" DROP CONSTRAINT "ImageFile_imageId_fkey"

ALTER TABLE "public"."LabFile" DROP CONSTRAINT "LabFile_labId_fkey"

ALTER TABLE "public"."AppointmentFile" ADD COLUMN "fileId" text   NOT NULL 

CREATE TABLE "public"."_FileToLab" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_FileToImage" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_FileToLab_AB_unique" ON "public"."_FileToLab"("A", "B")

CREATE INDEX "_FileToLab_B_index" ON "public"."_FileToLab"("B")

CREATE UNIQUE INDEX "_FileToImage_AB_unique" ON "public"."_FileToImage"("A", "B")

CREATE INDEX "_FileToImage_B_index" ON "public"."_FileToImage"("B")

ALTER TABLE "public"."_FileToLab" ADD FOREIGN KEY ("A")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_FileToLab" ADD FOREIGN KEY ("B")REFERENCES "public"."Lab"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_FileToImage" ADD FOREIGN KEY ("A")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_FileToImage" ADD FOREIGN KEY ("B")REFERENCES "public"."Image"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentFile" ADD FOREIGN KEY ("fileId")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."ImageFile"

DROP TABLE "public"."LabFile"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210403173105-comment-file-appo..20210403190453-appointment-files
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -255,32 +255,25 @@
   @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
 }
 model File {
-  id       String  @id @default(uuid())
-  url      String
-  filename String
-  mimetype String?
-  encoding String?
+  id               String            @id @default(uuid())
+  url              String
+  filename         String
+  mimetype         String?
+  encoding         String?
+  lab              Lab[]
+  image            Image[]
+  appointmentFiles AppointmentFile[]
 }
-model LabFile {
-  id    String @id @default(uuid())
-  lab   Lab    @relation(fields: [labId], references: [id])
-  labId String
-}
-
-model ImageFile {
-  id      String @id @default(uuid())
-  image   Image  @relation(fields: [imageId], references: [id])
-  imageId String
-}
-
 model AppointmentFile {
   id            String      @id @default(uuid())
   comment       String?
   appointment   Appointment @relation(fields: [appointmentId], references: [id])
   appointmentId String
+  file          File        @relation(fields: [fileId], references: [id])
+  fileId        String
 }
 model Configuration {
   id                   String  @id @default(uuid())
@@ -331,9 +324,9 @@
   labDefinition   LabDefinition @relation(fields: [labDefinitionId], references: [id])
   labDefinitionId String
   appointment     Appointment   @relation(fields: [appointmentId], references: [id])
   appointmentId   String
-  documents       LabFile[]
+  documents       File[]
 }
 model Image {
   id                String          @id @default(uuid())
@@ -346,9 +339,9 @@
   imageDefinition   ImageDefinition @relation(fields: [imageDefinitionId], references: [id])
   imageDefinitionId String
   appointment       Appointment     @relation(fields: [appointmentId], references: [id])
   appointmentId     String
-  documents         ImageFile[]
+  documents         File[]
 }
 model MedicineHistory {
   id           String    @id @default(uuid())
```


