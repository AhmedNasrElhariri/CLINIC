# Migration `20200930120503-v1`

This migration has been generated by etahoon at 9/30/2020, 2:05:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Organization" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"organizationId" text   NOT NULL ,
"permissions" jsonb   NOT NULL DEFAULT '[]',
"avatar" text   ,
"position" "Position"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Patient" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"phoneNo" text   NOT NULL ,
"type" "PatientMembershipType"  NOT NULL ,
"age" integer   NOT NULL ,
"sex" "Sex"  NOT NULL ,
"organizationId" text   NOT NULL ,
"guardianName" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Appointment" (
"id" text   NOT NULL ,
"date" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"type" "AppointmentType"  NOT NULL ,
"patientId" text   NOT NULL ,
"specialty" "Specialty"  NOT NULL ,
"doctorId" text   NOT NULL ,
"labs" text   DEFAULT E'[]',
"status" "AppointmentStatus"  NOT NULL ,
"clinicId" text   NOT NULL ,
"notes" text   DEFAULT E'',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."View" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ViewStatus" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
"defaultViewId" text   NOT NULL ,
"activeViewId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FieldGroup" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"order" integer   NOT NULL ,
"viewId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Field" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"order" integer   NOT NULL ,
"type" "FieldType"  NOT NULL ,
"required" boolean   NOT NULL ,
"fieldGroupId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."AppointmentField" (
"id" text   NOT NULL ,
"appointmentId" text   NOT NULL ,
"fieldId" text   NOT NULL ,
"value" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."File" (
"id" text   NOT NULL ,
"url" text   NOT NULL ,
"filename" text   NOT NULL ,
"mimetype" text   ,
"encoding" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Clinic" (
"id" text   NOT NULL ,
"name" text   ,
"examinationPrice" integer   NOT NULL DEFAULT 0,
"followupPrice" integer   NOT NULL DEFAULT 0,
"urgentPrice" integer   NOT NULL DEFAULT 0,
"duration" integer   NOT NULL DEFAULT 5,
"appointmentsCount" integer   NOT NULL DEFAULT 20,
"doctorName" text   DEFAULT E'',
"doctorNameAr" text   DEFAULT E'',
"doctorTitle" text   DEFAULT E'',
"doctorTitleAr" text   DEFAULT E'',
"doctorJobDescription" text   DEFAULT E'',
"doctorJobDescriptionAr" text   DEFAULT E'',
"phoneNo" text   DEFAULT E'',
"phoneNo1" text   DEFAULT E'',
"address" text   DEFAULT E'',
"address1" text   DEFAULT E'',
"logoId" text   ,
"organizationId" text   NOT NULL ,
"sessions" jsonb   NOT NULL DEFAULT '[]',
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Week" (
"id" text   NOT NULL ,
"weekNo" integer   NOT NULL ,
"year" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WorkingHours" (
"id" text   NOT NULL ,
"weekId" text   NOT NULL ,
"doctorId" text   NOT NULL ,
"start" timestamp(3)   NOT NULL ,
"end" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Snippet" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
"title" text   NOT NULL ,
"body" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PatientLab" (
"id" text   NOT NULL ,
"patientId" text   NOT NULL ,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."LabDocument" (
"id" text   NOT NULL ,
"fileId" text   NOT NULL ,
"patientLabId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."MedicalHistory" (
"id" text   NOT NULL ,
"medicineName" text   NOT NULL ,
"frequency" text   ,
"dose" text   ,
"fromDate" timestamp(3)   ,
"patientId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FamilyHistory" (
"id" text   NOT NULL ,
"disease" text   NOT NULL ,
"relative" text   NOT NULL ,
"patientId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Expense" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"date" timestamp(3)   NOT NULL ,
"amount" integer   NOT NULL ,
"invoiceNo" text   ,
"clinicId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Revenue" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"date" timestamp(3)   NOT NULL ,
"amount" integer   NOT NULL ,
"invoiceNo" text   ,
"clinicId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Notification" (
"id" text   NOT NULL ,
"notifierId" text   NOT NULL ,
"userId" text   NOT NULL ,
"type" text   NOT NULL ,
"message" text   NOT NULL ,
"viewed" boolean   NOT NULL DEFAULT false,
"date" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Event" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
"name" text   NOT NULL ,
"start" timestamp(3)   NOT NULL ,
"end" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_ClinicToUser" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Patient.phoneNo_unique" ON "public"."Patient"("phoneNo")

CREATE UNIQUE INDEX "userId_defaultViewId_activeViewId_unique_constraint" ON "public"."ViewStatus"("userId", "defaultViewId", "activeViewId")

CREATE UNIQUE INDEX "order_viewId_unique_constraint" ON "public"."FieldGroup"("order", "viewId")

CREATE UNIQUE INDEX "order_fieldGroupId_unique_constraint" ON "public"."Field"("order", "fieldGroupId")

CREATE UNIQUE INDEX "appointment_fieldId_unique_constraint" ON "public"."AppointmentField"("appointmentId", "fieldId")

CREATE UNIQUE INDEX "week_year_unique_constraint" ON "public"."Week"("weekNo", "year")

CREATE UNIQUE INDEX "Snippet.title_unique" ON "public"."Snippet"("title")

CREATE UNIQUE INDEX "name_patientId_unique_constraint" ON "public"."PatientLab"("name", "patientId")

CREATE UNIQUE INDEX "_ClinicToUser_AB_unique" ON "public"."_ClinicToUser"("A", "B")

CREATE INDEX "_ClinicToUser_B_index" ON "public"."_ClinicToUser"("B")

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("doctorId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("clinicId")REFERENCES "public"."Clinic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."View" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("defaultViewId")REFERENCES "public"."View"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("activeViewId")REFERENCES "public"."View"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FieldGroup" ADD FOREIGN KEY ("viewId")REFERENCES "public"."View"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Field" ADD FOREIGN KEY ("fieldGroupId")REFERENCES "public"."FieldGroup"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentField" ADD FOREIGN KEY ("appointmentId")REFERENCES "public"."Appointment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentField" ADD FOREIGN KEY ("fieldId")REFERENCES "public"."Field"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Clinic" ADD FOREIGN KEY ("logoId")REFERENCES "public"."File"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."WorkingHours" ADD FOREIGN KEY ("weekId")REFERENCES "public"."Week"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WorkingHours" ADD FOREIGN KEY ("doctorId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Snippet" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."PatientLab" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."LabDocument" ADD FOREIGN KEY ("fileId")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."LabDocument" ADD FOREIGN KEY ("patientLabId")REFERENCES "public"."PatientLab"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MedicalHistory" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."FamilyHistory" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Expense" ADD FOREIGN KEY ("clinicId")REFERENCES "public"."Clinic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Revenue" ADD FOREIGN KEY ("clinicId")REFERENCES "public"."Clinic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Event" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ClinicToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Clinic"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ClinicToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200930120503-v1
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,304 @@
+datasource postgresql {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum AppointmentType {
+  Examination
+  Followup
+  Urgent
+  Session
+}
+
+enum AppointmentStatus {
+  Scheduled
+  Cancelled
+  Missed
+  Changed
+  Archived
+  Done
+}
+
+enum Position {
+  Doctor
+  Assistant
+}
+
+enum Sex {
+  Female
+  Male
+}
+
+enum Specialty {
+  Dentistry
+}
+
+enum FieldType {
+  Text
+  Number
+  LongText
+}
+
+enum PatientMembershipType {
+  Primary
+  Secondary
+}
+
+model Organization {
+  id   String @default(uuid()) @id
+  name String
+}
+
+model User {
+  id             String         @default(uuid()) @id
+  name           String
+  email          String         @unique
+  password       String
+  organizationId String
+  Appointment    Appointment[]
+  View           View[]
+  ViewStatus     ViewStatus[]
+  clinics        Clinic[]       @relation(references: [id])
+  WorkingHours   WorkingHours[]
+  Snippet        Snippet[]
+  permissions    Json           @default("[]")
+  avatar         String?
+  position       Position
+  events         Event[]
+}
+
+model Patient {
+  id             String                @default(uuid()) @id
+  name           String
+  phoneNo        String                @unique
+  type           PatientMembershipType
+  appointments   Appointment[]
+  age            Int
+  sex            Sex
+  organizationId String
+  guardianName   String?
+  pateintLab     PatientLab[]
+  MedicalHistory MedicalHistory[]
+  FamilyHistory  FamilyHistory[]
+}
+
+model Appointment {
+  id        String             @default(uuid()) @id
+  date      DateTime           @default(now())
+  type      AppointmentType
+  patient   Patient            @relation(fields: [patientId], references: [id])
+  patientId String
+  specialty Specialty
+  doctor    User               @relation(fields: [doctorId], references: [id])
+  doctorId  String
+  labs      String?            @default("[]")
+  status    AppointmentStatus
+  data      AppointmentField[]
+  clinic    Clinic             @relation(fields: [clinicId], references: [id])
+  clinicId  String
+  notes     String?            @default("")
+}
+
+model View {
+  id                   String       @default(uuid()) @id
+  name                 String
+  user                 User         @relation(fields: [userId], references: [id])
+  userId               String
+  fieldGroups          FieldGroup[]
+  defaultViewsStatuses ViewStatus[] @relation("defaultView")
+  activeViewsStatuses  ViewStatus[] @relation("activeView")
+}
+
+model ViewStatus {
+  id            String @default(uuid()) @id
+  user          User   @relation(fields: [userId], references: [id])
+  userId        String
+  defaultView   View   @relation("defaultView", fields: [defaultViewId], references: [id])
+  defaultViewId String
+  activeView    View   @relation("activeView", fields: [activeViewId], references: [id])
+  activeViewId  String
+
+  @@unique([userId, defaultViewId, activeViewId], name: "userId_defaultViewId_activeViewId_unique_constraint")
+}
+
+model FieldGroup {
+  id     String  @default(uuid()) @id
+  name   String
+  order  Int
+  view   View    @relation(fields: [viewId], references: [id])
+  viewId String
+  fields Field[]
+
+  @@unique([order, viewId], name: "order_viewId_unique_constraint")
+}
+
+model Field {
+  id                String             @default(uuid()) @id
+  name              String
+  order             Int
+  type              FieldType
+  required          Boolean
+  fieldGroup        FieldGroup?        @relation(fields: [fieldGroupId], references: [id])
+  fieldGroupId      String?
+  appointmentFields AppointmentField[]
+
+  @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
+}
+
+model AppointmentField {
+  id            String      @default(uuid()) @id
+  appointment   Appointment @relation(fields: [appointmentId], references: [id])
+  appointmentId String
+  field         Field       @relation(fields: [fieldId], references: [id])
+  fieldId       String
+  value         String
+
+  @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
+}
+
+model File {
+  id          String        @default(uuid()) @id
+  url         String
+  filename    String
+  mimetype    String?
+  encoding    String?
+  Clinic      Clinic[]
+  LabDocument LabDocument[]
+}
+
+model Clinic {
+  id                String  @default(uuid()) @id
+  name              String?
+  examinationPrice  Int     @default(0)
+  followupPrice     Int     @default(0)
+  urgentPrice       Int     @default(0)
+  duration          Int     @default(5)
+  appointmentsCount Int     @default(20)
+
+
+  // shown in prescription
+  doctorName             String? @default("")
+  doctorNameAr           String? @default("")
+  doctorTitle            String? @default("")
+  doctorTitleAr          String? @default("")
+  doctorJobDescription   String? @default("")
+  doctorJobDescriptionAr String? @default("")
+  phoneNo                String? @default("")
+  phoneNo1               String? @default("")
+  address                String? @default("")
+  address1               String? @default("")
+
+  logo           File?         @relation(fields: [logoId], references: [id])
+  logoId         String?
+  users          User[]        @relation(references: [id])
+  organizationId String
+  Expense        Expense[]
+  Revenue        Revenue[]
+  Appointment    Appointment[]
+  sessions       Json          @default("[]")
+}
+
+model Week {
+  id     String @default(uuid()) @id
+  weekNo Int
+  year   Int
+
+  @@unique([weekNo, year], name: "week_year_unique_constraint")
+  WorkingHours WorkingHours[]
+}
+
+model WorkingHours {
+  id       String   @default(uuid()) @id
+  week     Week     @relation(fields: [weekId], references: [id])
+  weekId   String
+  doctor   User     @relation(fields: [doctorId], references: [id])
+  doctorId String
+  start    DateTime
+  end      DateTime
+}
+
+model Snippet {
+  id     String @default(uuid()) @id
+  user   User   @relation(fields: [userId], references: [id])
+  userId String
+  title  String @unique
+  body   String
+}
+
+model PatientLab {
+  id        String        @default(uuid()) @id
+  patient   Patient       @relation(fields: [patientId], references: [id])
+  patientId String
+  name      String
+  documents LabDocument[]
+  @@unique([name, patientId], name: "name_patientId_unique_constraint")
+}
+
+model LabDocument {
+  id           String     @default(uuid()) @id
+  file         File       @relation(fields: [fileId], references: [id])
+  fileId       String
+  patientLab   PatientLab @relation(fields: [patientLabId], references: [id])
+  patientLabId String
+}
+
+model MedicalHistory {
+  id           String    @default(uuid()) @id
+  medicineName String
+  frequency    String?
+  dose         String?
+  fromDate     DateTime?
+  patient      Patient   @relation(fields: [patientId], references: [id])
+  patientId    String
+}
+
+model FamilyHistory {
+  id        String  @default(uuid()) @id
+  disease   String
+  relative  String
+  patient   Patient @relation(fields: [patientId], references: [id])
+  patientId String
+}
+
+model Expense {
+  id        String   @default(uuid()) @id
+  name      String
+  date      DateTime
+  amount    Int
+  invoiceNo String?
+  clinic    Clinic   @relation(fields: [clinicId], references: [id])
+  clinicId  String
+}
+
+model Revenue {
+  id        String   @default(uuid()) @id
+  name      String
+  date      DateTime
+  amount    Int
+  invoiceNo String?
+  clinic    Clinic   @relation(fields: [clinicId], references: [id])
+  clinicId  String
+}
+
+model Notification {
+  id         String   @default(uuid()) @id
+  notifierId String
+  userId     String
+  type       String
+  message    String
+  viewed     Boolean  @default(false)
+  date       DateTime @default(now())
+}
+
+model Event {
+  id     String   @default(uuid()) @id
+  user   User     @relation(fields: [userId], references: [id])
+  userId String
+  name   String
+  start  DateTime
+  end    DateTime
+}
```


