# Migration `20210129025436-add-actions-table`

This migration has been generated by etahoon at 1/29/2021, 4:54:36 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."action_roleId_unique_constraint"

ALTER TABLE "public"."Permission" DROP COLUMN "action",
ADD COLUMN "actionId" text   NOT NULL 

DROP TYPE "PermissionAction"

CREATE TABLE "public"."Action" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"subject" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "actionId_roleId_unique_constraint" ON "public"."Permission"("actionId", "roleId")

ALTER TABLE "public"."Permission" ADD FOREIGN KEY ("actionId")REFERENCES "public"."Action"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210125040201-add-branches-specalites..20210129025436-add-actions-table
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -413,12 +413,8 @@
 }
 // permissions
-enum PermissionAction {
-  Appointment_Create
-}
-
 enum PermissionLevel {
   Organization
   Branch
   Specialty
@@ -433,18 +429,19 @@
   permission     Permission[]
 }
 model Permission {
-  id             String           @id @default(uuid())
-  role           Role             @relation(fields: [roleId], references: [id])
+  id             String          @id @default(uuid())
+  role           Role            @relation(fields: [roleId], references: [id])
   roleId         String
-  action         PermissionAction
+  action         Action          @relation(fields: [actionId], references: [id])
+  actionId       String
   level          PermissionLevel
   rules          Rule[]
-  organization   Organization     @relation(fields: [organizationId], references: [id])
+  organization   Organization    @relation(fields: [organizationId], references: [id])
   organizationId String
-  @@unique([action, roleId], name: "action_roleId_unique_constraint")
+  @@unique([actionId, roleId], name: "actionId_roleId_unique_constraint")
 }
 model Rule {
   id             String       @id @default(uuid())
@@ -477,5 +474,12 @@
   rules          Rule[]
   branches       Branch[]
 }
+model Action {
+  id         String       @id @default(uuid())
+  name       String
+  subject    String
+  Permission Permission[]
+}
+
 // end permission
```


