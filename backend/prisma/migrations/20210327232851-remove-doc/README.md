# Migration `20210327232851-remove-doc`

This migration has been generated by etahoon at 3/28/2021, 1:28:51 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."ImageDocument" DROP CONSTRAINT "ImageDocument_fileId_fkey"

ALTER TABLE "public"."ImageDocument" DROP CONSTRAINT "ImageDocument_imageId_fkey"

ALTER TABLE "public"."LabDocument" DROP CONSTRAINT "LabDocument_fileId_fkey"

ALTER TABLE "public"."LabDocument" DROP CONSTRAINT "LabDocument_labId_fkey"

CREATE TABLE "public"."_FileToLab" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_FileToImage" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_FileToLab_AB_unique" ON "public"."_FileToLab"("A", "B")

CREATE INDEX "_FileToLab_B_index" ON "public"."_FileToLab"("B")

CREATE UNIQUE INDEX "_FileToImage_AB_unique" ON "public"."_FileToImage"("A", "B")

CREATE INDEX "_FileToImage_B_index" ON "public"."_FileToImage"("B")

ALTER TABLE "public"."_FileToLab" ADD FOREIGN KEY ("A")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_FileToLab" ADD FOREIGN KEY ("B")REFERENCES "public"."Lab"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_FileToImage" ADD FOREIGN KEY ("A")REFERENCES "public"."File"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_FileToImage" ADD FOREIGN KEY ("B")REFERENCES "public"."Image"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."ImageDocument"

DROP TABLE "public"."LabDocument"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210320225135-init..20210327232851-remove-doc
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -255,18 +255,18 @@
   @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
 }
 model File {
-  id             String          @id @default(uuid())
-  url            String
-  filename       String
-  comment        String?
-  collection     Collection?     @relation(fields: [collectionId], references: [id])
-  collectionId   String?
-  mimetype       String?
-  encoding       String?
-  labDocuments   LabDocument[]
-  imageDocuments ImageDocument[]
+  id           String      @id @default(uuid())
+  url          String
+  filename     String
+  comment      String?
+  collection   Collection? @relation(fields: [collectionId], references: [id])
+  collectionId String?
+  mimetype     String?
+  encoding     String?
+  labs         Lab[]
+  images       Image[]
 }
 model Configuration {
   id                   String  @id @default(uuid())
@@ -305,16 +305,8 @@
   title  String @unique
   body   String
 }
-model LabDocument {
-  id     String @id @default(uuid())
-  file   File   @relation(fields: [fileId], references: [id])
-  fileId String
-  lab    Lab    @relation(fields: [labId], references: [id])
-  labId  String
-}
-
 model Lab {
   id              String        @id @default(uuid())
   status          LabStatus
   requiredDate    DateTime      @default(now())
@@ -325,19 +317,11 @@
   labDefinition   LabDefinition @relation(fields: [labDefinitionId], references: [id])
   labDefinitionId String
   appointment     Appointment   @relation(fields: [appointmentId], references: [id])
   appointmentId   String
-  documents       LabDocument[]
+  documents       File[]
 }
-model ImageDocument {
-  id      String  @id @default(uuid())
-  file    File?   @relation(fields: [fileId], references: [id])
-  fileId  String?
-  image   Image   @relation(fields: [imageId], references: [id])
-  imageId String
-}
-
 model Image {
   id                String          @id @default(uuid())
   status            LabStatus
   requiredDate      DateTime        @default(now())
@@ -348,9 +332,9 @@
   imageDefinition   ImageDefinition @relation(fields: [imageDefinitionId], references: [id])
   imageDefinitionId String
   appointment       Appointment     @relation(fields: [appointmentId], references: [id])
   appointmentId     String
-  documents         ImageDocument[]
+  documents         File[]
 }
 model MedicineHistory {
   id           String    @id @default(uuid())
```


