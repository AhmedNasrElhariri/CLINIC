# Migration `20210130092402-add-admin-position`

This migration has been generated by etahoon at 1/30/2021, 11:24:02 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TYPE "Position" ADD VALUE 'Admin'

ALTER TABLE "public"."Role" DROP CONSTRAINT "Role_organizationId_fkey"

ALTER TABLE "public"."Permission" DROP CONSTRAINT "Permission_roleId_fkey"

CREATE TABLE "public"."PermissionRole" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"organizationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."PermissionRole" ADD FOREIGN KEY ("organizationId")REFERENCES "public"."Organization"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Permission" ADD FOREIGN KEY ("roleId")REFERENCES "public"."PermissionRole"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."Role"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210129025436-add-actions-table..20210130092402-add-admin-position
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -25,8 +25,9 @@
   Closed
 }
 enum Position {
+  Admin
   Doctor
   Assistant
 }
@@ -69,9 +70,9 @@
   item           Item[]
   hospital       Hospital[]
   surgery        Surgery[]
   patientSurgery PatientSurgery[]
-  roles          Role[]
+  roles          PermissionRole[]
   permissions    Permission[]
   rules          Rule[]
   branchs        Branch[]
   specialties    Specialty[]
@@ -420,19 +421,19 @@
   Specialty
   User
 }
-model Role {
+model PermissionRole {
   id             String       @id @default(uuid())
   name           String
   organization   Organization @relation(fields: [organizationId], references: [id])
   organizationId String
-  permission     Permission[]
+  permissions    Permission[]
 }
 model Permission {
   id             String          @id @default(uuid())
-  role           Role            @relation(fields: [roleId], references: [id])
+  role           PermissionRole  @relation(fields: [roleId], references: [id])
   roleId         String
   action         Action          @relation(fields: [actionId], references: [id])
   actionId       String
   level          PermissionLevel
```


