# Migration `20200518072712-init`

This migration has been generated by etahoon at 5/18/2020, 7:27:12 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"email" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"organizationId" text  NOT NULL ,"password" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Patient" (
"age" integer  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"phoneNo" text  NOT NULL ,"sex" "Sex" NOT NULL ,"type" "PatientMembershipType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."View" (
"id" text  NOT NULL ,"name" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."ViewStatus" (
"activeViewId" text  NOT NULL ,"defaultViewId" text  NOT NULL ,"id" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."FieldGroup" (
"id" text  NOT NULL ,"name" text  NOT NULL ,"order" integer  NOT NULL ,"viewId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Field" (
"fieldGroupId" text   ,"id" text  NOT NULL ,"name" text  NOT NULL ,"order" integer  NOT NULL ,"required" boolean  NOT NULL ,"type" "FieldType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."AppointmentField" (
"appointmentId" text  NOT NULL ,"fieldId" text  NOT NULL ,"id" text  NOT NULL ,"value" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Appointment" ALTER COLUMN "glucoseLevel" SET DEFAULT -1,
ALTER COLUMN "height" SET DEFAULT -1,
ALTER COLUMN "pulse" SET DEFAULT -1,
ALTER COLUMN "temp" SET DEFAULT -1,
ALTER COLUMN "weight" SET DEFAULT -1;

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Patient.phoneNo" ON "public"."Patient"("phoneNo")

CREATE UNIQUE INDEX "userId_defaultViewId_activeViewId_unique_constraint" ON "public"."ViewStatus"("userId","defaultViewId","activeViewId")

CREATE UNIQUE INDEX "order_viewId_unique_constraint" ON "public"."FieldGroup"("order","viewId")

CREATE UNIQUE INDEX "order_fieldGroupId_unique_constraint" ON "public"."Field"("order","fieldGroupId")

CREATE UNIQUE INDEX "appointment_fieldId_unique_constraint" ON "public"."AppointmentField"("appointmentId","fieldId")

ALTER TABLE "public"."View" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("defaultViewId")REFERENCES "public"."View"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("activeViewId")REFERENCES "public"."View"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."FieldGroup" ADD FOREIGN KEY ("viewId")REFERENCES "public"."View"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Field" ADD FOREIGN KEY ("fieldGroupId")REFERENCES "public"."FieldGroup"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentField" ADD FOREIGN KEY ("appointmentId")REFERENCES "public"."Appointment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentField" ADD FOREIGN KEY ("fieldId")REFERENCES "public"."Field"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("doctorId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200518072712-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,149 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum AppointmentType {
+  Examination
+  Followup
+}
+
+enum AppointmentStatus {
+  Scheduled
+  Cancelled
+  Missed
+  Changed
+  Archived
+  Occurred
+}
+
+enum Sex {
+  Female
+  Male
+}
+
+enum Specialty {
+  Dentistry
+}
+
+enum FieldType {
+  Text
+  Number
+  LongText
+}
+
+enum PatientMembershipType {
+  Primary
+  Secondary
+}
+
+model Organization {
+  id   String @default(uuid()) @id
+  name String
+}
+
+model User {
+  id             String        @default(uuid()) @id
+  name           String
+  email          String        @unique
+  password       String
+  organizationId String
+  Appointment    Appointment[]
+  View           View[]
+  ViewStatus     ViewStatus[]
+}
+
+model Patient {
+  id           String                @default(uuid()) @id
+  name         String
+  phoneNo      String                @unique
+  type         PatientMembershipType
+  appointments Appointment[]
+  age          Int
+  sex          Sex
+}
+
+model Appointment {
+  id              String             @default(uuid()) @id
+  date            DateTime           @default(now()) @unique
+  type            AppointmentType
+  patient         Patient            @relation(fields: [patientId], references: [id])
+  patientId       String
+  specialty       Specialty
+  doctor          User               @relation(fields: [doctorId], references: [id])
+  doctorId        String
+  labs            String?            @default("[]")
+  complain        String?            @default("")
+  signs           String?            @default("")
+  diagnosis       String?            @default("")
+  treatment       String?            @default("")
+  recommendations String?            @default("")
+  weight          Float?             @default(-1)
+  height          Float?             @default(-1)
+  pulse           Float?             @default(-1)
+  temp            Float?             @default(-1)
+  glucoseLevel    Float?             @default(-1)
+  status          AppointmentStatus
+  data            AppointmentField[]
+}
+
+model View {
+  id                   String       @default(uuid()) @id
+  name                 String
+  user                 User         @relation(fields: [userId], references: [id])
+  userId               String
+  fieldGroups          FieldGroup[]
+  defaultViewsStatuses ViewStatus[] @relation("defaultView")
+  activeViewsStatuses  ViewStatus[] @relation("activeView")
+}
+
+model ViewStatus {
+  id            String @default(uuid()) @id
+  user          User   @relation(fields: [userId], references: [id])
+  userId        String
+  defaultView   View   @relation("defaultView", fields: [defaultViewId], references: [id])
+  defaultViewId String
+  activeView    View   @relation("activeView", fields: [activeViewId], references: [id])
+  activeViewId  String
+
+  @@unique([userId, defaultViewId, activeViewId], name: "userId_defaultViewId_activeViewId_unique_constraint")
+}
+
+model FieldGroup {
+  id     String  @default(uuid()) @id
+  name   String
+  order  Int
+  view   View    @relation(fields: [viewId], references: [id])
+  viewId String
+  fields Field[]
+
+  @@unique([order, viewId], name: "order_viewId_unique_constraint")
+}
+
+model Field {
+  id                String             @default(uuid()) @id
+  name              String
+  order             Int
+  type              FieldType
+  required          Boolean
+  fieldGroup        FieldGroup?        @relation(fields: [fieldGroupId], references: [id])
+  fieldGroupId      String?
+  appointmentFields AppointmentField[]
+
+  @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
+}
+
+model AppointmentField {
+  id            String      @default(uuid()) @id
+  appointment   Appointment @relation(fields: [appointmentId], references: [id])
+  appointmentId String
+  field         Field       @relation(fields: [fieldId], references: [id])
+  fieldId       String
+  value         String
+
+  @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
+}
```


