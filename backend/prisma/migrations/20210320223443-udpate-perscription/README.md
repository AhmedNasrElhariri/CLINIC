# Migration `20210320223443-udpate-perscription`

This migration has been generated by etahoon at 3/21/2021, 12:34:43 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Prescription" DROP CONSTRAINT "Prescription_medicineId_fkey"

ALTER TABLE "public"."Prescription" DROP COLUMN "durationLength",
DROP COLUMN "durationType",
ADD COLUMN "dose" text   ,
ADD COLUMN "duration" integer   NOT NULL ,
ADD COLUMN "period" text   NOT NULL 

ALTER TABLE "public"."Prescription" ADD FOREIGN KEY ("medicineId")REFERENCES "public"."MedicineDefinition"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210313104045-add-prescription..20210320223443-udpate-perscription
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -165,9 +165,8 @@
   medicineHistory  MedicineHistory[]
   familyHistory    FamilyHistory[]
   inventoryHistory InventoryHistory[]
   patientSurgeries PatientSurgery[]
-  prescriptions    Prescription[]
   labs             Lab[]
   images           Image[]
 }
@@ -190,17 +189,18 @@
   prescription     Prescription[]
 }
 model Prescription {
-  id             String       @id @default(uuid())
-  medicine       Patient      @relation(fields: [medicineId], references: [id])
-  medicineId     String
-  timing         Timing       @relation(fields: [timingId], references: [id])
-  timingId       String
-  durationLength Int
-  durationType   String
-  appointment    Appointment? @relation(fields: [appointmentId], references: [id])
-  appointmentId  String?
+  id            String             @id @default(uuid())
+  dose          String?
+  medicine      MedicineDefinition @relation(fields: [medicineId], references: [id])
+  medicineId    String
+  timing        Timing             @relation(fields: [timingId], references: [id])
+  timingId      String
+  duration      Int
+  period        String
+  appointment   Appointment?       @relation(fields: [appointmentId], references: [id])
+  appointmentId String?
 }
 model View {
   id                  String          @id @default(uuid())
@@ -512,14 +512,15 @@
   userId String
 }
 model MedicineDefinition {
-  id            String @id @default(uuid())
+  id            String         @id @default(uuid())
   name          String
   concentration String
   form          String
-  user          User   @relation(fields: [userId], references: [id])
+  user          User           @relation(fields: [userId], references: [id])
   userId        String
+  prescriptions Prescription[]
 }
 model PatientReport {
   id     String @id @default(uuid())
```


