# Migration `20200514214957-add-view-statuses`

This migration has been generated by etahoon at 5/14/2020, 9:49:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."ViewStatus" (
"activeViewId" text  NOT NULL ,"defaultViewId" text  NOT NULL ,"id" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Appointment" ALTER COLUMN "glucoseLevel" SET DEFAULT -1,
ALTER COLUMN "height" SET DEFAULT -1,
ALTER COLUMN "pulse" SET DEFAULT -1,
ALTER COLUMN "temp" SET DEFAULT -1,
ALTER COLUMN "weight" SET DEFAULT -1;

ALTER TABLE "public"."View" DROP COLUMN "default",
ADD COLUMN "active" boolean  NOT NULL ;

CREATE UNIQUE INDEX "userId_defaultViewId_activeViewId_unique_constraint" ON "public"."ViewStatus"("userId","defaultViewId","activeViewId")

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("defaultViewId")REFERENCES "public"."View"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ViewStatus" ADD FOREIGN KEY ("activeViewId")REFERENCES "public"."View"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200514201212-create-user-view..20200514214957-add-view-statuses
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -44,8 +44,9 @@
   password       String
   organizationId String
   Appointment    Appointment[]
   View           View[]
+  ViewStatus     ViewStatus[]
 }
 model Patient {
   id           String                @default(uuid()) @id
@@ -81,16 +82,30 @@
   data            AppointmentField[]
 }
 model View {
-  id         String       @default(uuid()) @id
-  name       String
-  default    Boolean      @default(false)
-  user       User         @relation(fields: [userId], references: [id])
-  userId     String
-  FieldGroup FieldGroup[]
+  id                   String       @default(uuid()) @id
+  name                 String
+  active               Boolean
+  user                 User         @relation(fields: [userId], references: [id])
+  userId               String
+  fieldGroups          FieldGroup[]
+  defaultViewsStatuses ViewStatus[] @relation("defaultView")
+  activeViewsStatuses  ViewStatus[] @relation("activeView")
 }
+model ViewStatus {
+  id            String @default(uuid()) @id
+  user          User   @relation(fields: [userId], references: [id])
+  userId        String
+  defaultView   View   @relation("defaultView", fields: [defaultViewId], references: [id])
+  defaultViewId String
+  activeView    View   @relation("activeView", fields: [activeViewId], references: [id])
+  activeViewId  String
+
+  @@unique([userId, defaultViewId, activeViewId], name: "userId_defaultViewId_activeViewId_unique_constraint")
+}
+
 model FieldGroup {
   id     String  @default(uuid()) @id
   name   String
   order  Int
@@ -101,16 +116,16 @@
   @@unique([order, viewId], name: "order_viewId_unique_constraint")
 }
 model Field {
-  id               String             @default(uuid()) @id
-  name             String
-  order            Int
-  type             FieldType
-  required         Boolean
-  fieldGroup       FieldGroup?        @relation(fields: [fieldGroupId], references: [id])
-  fieldGroupId     String?
-  AppointmentField AppointmentField[]
+  id                String             @default(uuid()) @id
+  name              String
+  order             Int
+  type              FieldType
+  required          Boolean
+  fieldGroup        FieldGroup?        @relation(fields: [fieldGroupId], references: [id])
+  fieldGroupId      String?
+  appointmentFields AppointmentField[]
   @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
 }
```


