# Migration `20200508164714-init`

This migration has been generated by etahoon at 5/8/2020, 4:47:14 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Organization" (
"id" text  NOT NULL ,"name" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"email" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"organizationId" text  NOT NULL ,"password" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Patient" (
"age" integer  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"phoneNo" text  NOT NULL ,"sex" "Sex" NOT NULL ,"type" "PatientMembershipType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Appointment" (
"archived" boolean  NOT NULL DEFAULT false,"complain" text   DEFAULT '',"date" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"diagnosis" text   DEFAULT '',"doctorId" text  NOT NULL ,"glucoseLevel" Decimal(65,30)   DEFAULT -1,"height" Decimal(65,30)   DEFAULT -1,"id" text  NOT NULL ,"labs" text   DEFAULT '[]',"patientId" text  NOT NULL ,"pulse" Decimal(65,30)   DEFAULT -1,"recommendations" text   DEFAULT '',"signs" text   DEFAULT '',"specialty" "Specialty" NOT NULL ,"temp" Decimal(65,30)   DEFAULT -1,"treatment" text   DEFAULT '',"type" "AppointmentType" NOT NULL ,"weight" Decimal(65,30)   DEFAULT -1,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."FieldGroup" (
"id" text  NOT NULL ,"name" text  NOT NULL ,"order" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Field" (
"fieldGroupId" text   ,"id" text  NOT NULL ,"name" text  NOT NULL ,"order" integer  NOT NULL ,"required" boolean  NOT NULL ,"type" "FieldType" NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Patient.phoneNo" ON "public"."Patient"("phoneNo")

CREATE UNIQUE INDEX "Appointment.date" ON "public"."Appointment"("date")

CREATE UNIQUE INDEX "FieldGroup.order" ON "public"."FieldGroup"("order")

CREATE UNIQUE INDEX "order_fieldGroupId_unique_constraint" ON "public"."Field"("order","fieldGroupId")

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("patientId")REFERENCES "public"."Patient"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Appointment" ADD FOREIGN KEY ("doctorId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Field" ADD FOREIGN KEY ("fieldGroupId")REFERENCES "public"."FieldGroup"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200508164714-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,99 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum AppointmentType {
+  Examination
+  Followup
+}
+
+enum Sex {
+  Female
+  Male
+}
+
+enum Specialty {
+  Dentistry
+}
+
+enum FieldType {
+  Text
+  Number
+  LongText
+}
+
+enum PatientMembershipType {
+  Primary
+  Secondary
+}
+
+model Organization {
+  id   String @default(uuid()) @id
+  name String
+}
+
+model User {
+  id             String        @default(uuid()) @id
+  name           String
+  email          String        @unique
+  password       String
+  organizationId String
+  Appointment    Appointment[]
+}
+
+model Patient {
+  id           String                @default(uuid()) @id
+  name         String
+  phoneNo      String                @unique
+  type         PatientMembershipType
+  appointments Appointment[]
+  age          Int
+  sex          Sex
+}
+
+model Appointment {
+  id              String          @default(uuid()) @id
+  date            DateTime        @default(now()) @unique
+  type            AppointmentType
+  patient         Patient         @relation(fields: [patientId], references: [id])
+  patientId       String
+  specialty       Specialty
+  doctor          User            @relation(fields: [doctorId], references: [id])
+  doctorId        String
+  labs            String?         @default("[]")
+  complain        String?         @default("")
+  signs           String?         @default("")
+  diagnosis       String?         @default("")
+  treatment       String?         @default("")
+  recommendations String?         @default("")
+  weight          Float?          @default(-1)
+  height          Float?          @default(-1)
+  pulse           Float?          @default(-1)
+  temp            Float?          @default(-1)
+  glucoseLevel    Float?          @default(-1)
+  archived        Boolean         @default(false)
+}
+
+model FieldGroup {
+  id     String   @default(uuid()) @id
+  name   String
+  fields Field[]
+  order  Int      @unique
+}
+
+model Field {
+  id           String      @default(uuid()) @id
+  name         String
+  order        Int
+  type         FieldType
+  required     Boolean
+  FieldGroup   FieldGroup? @relation(fields: [fieldGroupId], references: [id])
+  fieldGroupId String?
+
+  @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
+}
```


