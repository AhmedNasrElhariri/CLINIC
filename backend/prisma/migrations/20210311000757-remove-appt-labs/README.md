# Migration `20210311000757-remove-appt-labs`

This migration has been generated by etahoon at 3/11/2021, 2:07:57 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."AppointmentLab" DROP CONSTRAINT "AppointmentLab_appointmentId_fkey"

ALTER TABLE "public"."AppointmentLab" DROP CONSTRAINT "AppointmentLab_labDefinitionId_fkey"

ALTER TABLE "public"."Lab" ADD COLUMN "appointmentId" text   NOT NULL 

ALTER TABLE "public"."Lab" ADD FOREIGN KEY ("appointmentId")REFERENCES "public"."Appointment"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."AppointmentLab"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210310213732-init..20210311000757-remove-appt-labs
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -184,10 +184,10 @@
   notes            String?            @default("")
   patientSurgeries PatientSurgery[]
   prescription     Prescription?      @relation(fields: [prescriptionId], references: [id])
   prescriptionId   String?
-  labs             AppointmentLab[]
   appointmentLabId String?
+  labs             Lab[]
 }
 model Prescription {
   id             String        @id @default(uuid())
@@ -199,19 +199,8 @@
   durationType   String
   appointments   Appointment[]
 }
-model AppointmentLab {
-  id String @id @default(uuid())
-
-  labDefinition   LabDefinition @relation(fields: [labDefinitionId], references: [id])
-  labDefinitionId String
-
-  appointment   Appointment @relation(fields: [appointmentId], references: [id])
-  appointmentId String
-
-}
-
 model View {
   id                  String          @id @default(uuid())
   name                String
   type                AppointmentType @default(Examination)
@@ -332,8 +321,10 @@
   patient         Patient       @relation(fields: [patientId], references: [id])
   patientId       String
   labDefinition   LabDefinition @relation(fields: [labDefinitionId], references: [id])
   labDefinitionId String
+  appointment     Appointment   @relation(fields: [appointmentId], references: [id])
+  appointmentId   String
   documents       LabDocument[]
 }
 model ImageDocument {
@@ -475,15 +466,14 @@
   PatientSurgery PatientSurgery[]
 }
 model LabDefinition {
-  id       String           @id @default(uuid())
+  id       String @id @default(uuid())
   name     String
   category String
-  user     User             @relation(fields: [userId], references: [id])
+  user     User   @relation(fields: [userId], references: [id])
   userId   String
-  labs     AppointmentLab[]
-  Lab      Lab[]
+  labs     Lab[]
 }
 model LabCategory {
   id     String @id @default(uuid())
```


