# Migration `20210403171549-update-files`

This migration has been generated by etahoon at 4/3/2021, 7:15:49 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Collection" DROP CONSTRAINT "Collection_appointmentId_fkey"

ALTER TABLE "public"."_FileToImage" DROP CONSTRAINT "_FileToImage_A_fkey"

ALTER TABLE "public"."_FileToImage" DROP CONSTRAINT "_FileToImage_B_fkey"

ALTER TABLE "public"."_FileToLab" DROP CONSTRAINT "_FileToLab_A_fkey"

ALTER TABLE "public"."_FileToLab" DROP CONSTRAINT "_FileToLab_B_fkey"

ALTER TABLE "public"."File" DROP CONSTRAINT "File_collectionId_fkey"

ALTER TABLE "public"."File" DROP COLUMN "comment",
DROP COLUMN "collectionId"

CREATE TABLE "public"."LabFile" (
"id" text   NOT NULL ,
"labId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ImageFile" (
"id" text   NOT NULL ,
"imageId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."AppointmentFile" (
"id" text   NOT NULL ,
"appointmentId" text   NOT NULL ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."LabFile" ADD FOREIGN KEY ("labId")REFERENCES "public"."Lab"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ImageFile" ADD FOREIGN KEY ("imageId")REFERENCES "public"."Image"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."AppointmentFile" ADD FOREIGN KEY ("appointmentId")REFERENCES "public"."Appointment"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."Collection"

DROP TABLE "public"."_FileToImage"

DROP TABLE "public"."_FileToLab"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210327232851-remove-doc..20210403171549-update-files
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -179,15 +179,15 @@
   user             User               @relation(fields: [userId], references: [id])
   userId           String
   status           AppointmentStatus
   data             AppointmentField[]
-  collections      Collection[]
   notes            String?            @default("")
   patientSurgeries PatientSurgery[]
   appointmentLabId String?
+  prescription     Prescription[]
   labs             Lab[]
   images           Image[]
-  prescription     Prescription[]
+  pictures         AppointmentFile[]
 }
 model Prescription {
   id            String             @id @default(uuid())
@@ -255,20 +255,33 @@
   @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
 }
 model File {
-  id           String      @id @default(uuid())
-  url          String
-  filename     String
-  comment      String?
-  collection   Collection? @relation(fields: [collectionId], references: [id])
-  collectionId String?
-  mimetype     String?
-  encoding     String?
-  labs         Lab[]
-  images       Image[]
+  id       String  @id @default(uuid())
+  url      String
+  filename String
+  mimetype String?
+  encoding String?
 }
+model LabFile {
+  id    String @id @default(uuid())
+  lab   Lab    @relation(fields: [labId], references: [id])
+  labId String
+}
+
+model ImageFile {
+  id      String @id @default(uuid())
+  image   Image  @relation(fields: [imageId], references: [id])
+  imageId String
+}
+
+model AppointmentFile {
+  id            String      @id @default(uuid())
+  appointment   Appointment @relation(fields: [appointmentId], references: [id])
+  appointmentId String
+}
+
 model Configuration {
   id                   String  @id @default(uuid())
   user                 User    @relation(fields: [userId], references: [id])
   userId               String
@@ -317,9 +330,9 @@
   labDefinition   LabDefinition @relation(fields: [labDefinitionId], references: [id])
   labDefinitionId String
   appointment     Appointment   @relation(fields: [appointmentId], references: [id])
   appointmentId   String
-  documents       File[]
+  documents       LabFile[]
 }
 model Image {
   id                String          @id @default(uuid())
@@ -332,9 +345,9 @@
   imageDefinition   ImageDefinition @relation(fields: [imageDefinitionId], references: [id])
   imageDefinitionId String
   appointment       Appointment     @relation(fields: [appointmentId], references: [id])
   appointmentId     String
-  documents         File[]
+  documents         ImageFile[]
 }
 model MedicineHistory {
   id           String    @id @default(uuid())
@@ -392,16 +405,8 @@
   start  DateTime
   end    DateTime
 }
-model Collection {
-  id            String      @id @default(uuid())
-  appointment   Appointment @relation(fields: [appointmentId], references: [id])
-  appointmentId String
-  caption       String      @default("")
-  images        File[]
-}
-
 model Item {
   id               String             @id @default(uuid())
   name             String             @unique
   unitOfMeasure    UnitOfMeaure
```


