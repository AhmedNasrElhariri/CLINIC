# Migration `20210125040201-add-branches-specalites`

This migration has been generated by etahoon at 1/25/2021, 6:02:01 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Appointment" DROP COLUMN "prescription"

CREATE TABLE "public"."_BranchToSpecialty" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_BranchToSpecialty_AB_unique" ON "public"."_BranchToSpecialty"("A", "B")

CREATE INDEX "_BranchToSpecialty_B_index" ON "public"."_BranchToSpecialty"("B")

CREATE UNIQUE INDEX "action_roleId_unique_constraint" ON "public"."Permission"("action", "roleId")

ALTER TABLE "public"."_BranchToSpecialty" ADD FOREIGN KEY ("A")REFERENCES "public"."Branch"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BranchToSpecialty" ADD FOREIGN KEY ("B")REFERENCES "public"."Specialty"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210125032709-init..20210125040201-add-branches-specalites
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -34,12 +34,8 @@
   Female
   Male
 }
-// enum Specialty {
-//   Dentistry
-// }
-
 enum FieldType {
   Text
   Number
   LongText
@@ -118,27 +114,22 @@
   patientSurgery   PatientSurgery[]
 }
 model Appointment {
-  id           String             @id @default(uuid())
-  date         DateTime           @default(now())
-  type         AppointmentType
-  patient      Patient            @relation(fields: [patientId], references: [id])
-  patientId    String
-  doctor       User               @relation(fields: [doctorId], references: [id])
-  doctorId     String
-  labs         String?            @default("[]")
-  status       AppointmentStatus
-  data         AppointmentField[]
-  collections  Collection[]
-  clinic       Clinic             @relation(fields: [clinicId], references: [id])
-  clinicId     String
-  notes        String?            @default("")
-  prescription String?            @default("")
-  // specialty    Specialty          @relation(fields: [specialtyId], references: [id])
-  // specialtyId  String
-  // Specialty    Specialty?         @relation(fields: [specialtyId], references: [id])
-  // specialtyId  String?
+  id          String             @id @default(uuid())
+  date        DateTime           @default(now())
+  type        AppointmentType
+  patient     Patient            @relation(fields: [patientId], references: [id])
+  patientId   String
+  doctor      User               @relation(fields: [doctorId], references: [id])
+  doctorId    String
+  labs        String?            @default("[]")
+  status      AppointmentStatus
+  data        AppointmentField[]
+  collections Collection[]
+  clinic      Clinic             @relation(fields: [clinicId], references: [id])
+  clinicId    String
+  notes       String?            @default("")
 }
 model View {
   id                  String          @id @default(uuid())
@@ -450,8 +441,10 @@
   level          PermissionLevel
   rules          Rule[]
   organization   Organization     @relation(fields: [organizationId], references: [id])
   organizationId String
+
+  @@unique([action, roleId], name: "action_roleId_unique_constraint")
 }
 model Rule {
   id             String       @id @default(uuid())
@@ -472,15 +465,17 @@
   name           String
   organization   Organization @relation(fields: [organizationId], references: [id])
   organizationId String
   rules          Rule[]
+  Specialties    Specialty[]
 }
 model Specialty {
   id             String       @id @default(uuid())
   name           String
   organization   Organization @relation(fields: [organizationId], references: [id])
   organizationId String
   rules          Rule[]
+  branches       Branch[]
 }
 // end permission
```


