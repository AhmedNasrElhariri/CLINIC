# Migration `20210408143339-update`

This migration has been generated by ahmed nasr at 4/8/2021, 4:33:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."AppointmentsOnCourses" DROP CONSTRAINT "AppointmentsOnCourses_appointmentId_fkey"

ALTER TABLE "public"."AppointmentsOnCourses" DROP CONSTRAINT "AppointmentsOnCourses_courseId_fkey"

CREATE TABLE "public"."_AppointmentToCourse" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "_AppointmentToCourse_AB_unique" ON "public"."_AppointmentToCourse"("A", "B")

CREATE INDEX "_AppointmentToCourse_B_index" ON "public"."_AppointmentToCourse"("B")

ALTER TABLE "public"."_AppointmentToCourse" ADD FOREIGN KEY ("A")REFERENCES "public"."Appointment"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_AppointmentToCourse" ADD FOREIGN KEY ("B")REFERENCES "public"."Course"("id") ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE "public"."AppointmentsOnCourses"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210407111634-add-new..20210408143339-update
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -178,34 +178,25 @@
   images           Image[]
   Course           Course[]
 }
-model AppointmentsOnCourses {
-  appointment   Appointment @relation(fields: [appointmentId], references: [id])
-  appointmentId String
-  course        Course      @relation(fields: [courseId], references: [id])
-  courseId      String
-
-  @@id([appointmentId, courseId])
-}
-
 model Appointment {
-  id               String                  @id @default(uuid())
-  date             DateTime                @default(now())
+  id               String             @id @default(uuid())
+  date             DateTime           @default(now())
   type             AppointmentType
-  patient          Patient                 @relation(fields: [patientId], references: [id])
+  patient          Patient            @relation(fields: [patientId], references: [id])
   patientId        String
-  user             User                    @relation(fields: [userId], references: [id])
+  user             User               @relation(fields: [userId], references: [id])
   userId           String
   status           AppointmentStatus
   data             AppointmentField[]
-  notes            String?                 @default("")
+  notes            String?            @default("")
   patientSurgeries PatientSurgery[]
   prescription     Prescription[]
   labs             Lab[]
   images           Image[]
   pictures         AppointmentFile[]
-  courses          AppointmentsOnCourses[]
+  courses          Course[]
 }
 model Prescription {
   id            String             @id @default(uuid())
@@ -519,20 +510,20 @@
   Course         Course[]
 }
 model Course {
-  id                 String                  @id @default(uuid())
+  id                 String           @id @default(uuid())
   price              Int
   paid               Int
   discount           Int
-  appointments       AppointmentsOnCourses[]
-  patient            Patient                 @relation(fields: [patientId], references: [id])
+  appointments       Appointment[]
+  patient            Patient          @relation(fields: [patientId], references: [id])
   patientId          String
-  user               User                    @relation("user", fields: [userId], references: [id])
+  user               User             @relation("user", fields: [userId], references: [id])
   userId             String
-  courseDefinition   CourseDefinition        @relation(fields: [courseDefinitionId], references: [id])
+  courseDefinition   CourseDefinition @relation(fields: [courseDefinitionId], references: [id])
   courseDefinitionId String
-  doctor             User                    @relation("doctor", fields: [doctorId], references: [id])
+  doctor             User             @relation("doctor", fields: [doctorId], references: [id])
   doctorId           String
 }
 model ImageCategory {
```


