datasource postgresql {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum AppointmentType {
  Examination
  Followup
  Course
  Urgent
  Session
  Surgery
}

enum CourseType {
  Session
  Perunit

}

enum CourseStatus {
  InProgress
  Finished
  EarlyFinished
}

enum PayrollStatus {
  Open
  Close
}

enum PayrollTransactionType {
  Commision
  Advance
  Incentive
  Deduction
  Salary
}

enum LabStatus {
  Draft
  Pending
  Completed
}

enum AppointmentStatus {
  Scheduled
  Cancelled
  Missed
  Changed
  Archived
  Waiting
}

enum Position {
  Admin
  Doctor
  Assistant
}

enum Sex {
  Female
  Male
}

enum FieldType {
  Text
  Number
  LongText
  Radio
  Check
  NestedSelector
}

enum PatientMembershipType {
  Primary
  Secondary
}

enum UnitOfMeaure {
  PerUnit
  Milligram
  Kilogram
  Millimeter
  Centimetre
  Tablet
  Stripe
}

enum InventoryOperation {
  Add
  Substract
}

enum PermissionAction {
  List_Appointment
  Create_Appointment
  Reschedule_Appointment
  Finish_Appointment
  Cancel_Appointment
  Archive_Appointment
  View_Patient
  View_Accounting
  AddRevenue_Accounting
  AddExpense_Accounting
  EditRevenue_Accounting
  EditExpense_Accounting
  Print_Accounting
  View_Calendar
  CreateEvent_Calendar
  View_Inventory
  AddItem_Inventory
  ViewHistory_Inventory
  DefineItem_Inventory
  Create_Course
  List_Price
  Create_Price
  List_Session
  Create_Session
  Create_Hospital
  List_Hospital
  Create_Surgery
  List_Surgery
  View_Payroll
  Create_Commission
  Create_Deduction
  Create_Incentives
  Create_Advance
  Define_Sales
  Create_Sales
  View_Sales
  Create_Payslips
}

////////////////////////////////////////////////////////////////////////////////////////////////////////

model Organization {
  id                       String                     @id @default(uuid())
  name                     String
  invoiceCounter           Int                        @default(1)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now()) @updatedAt
  item                     Item[]
  hospital                 Hospital[]
  surgeries                Surgery[]
  patientSurgeries         PatientSurgery[]
  roles                    PermissionRole[]
  permissions              Permission[]
  rules                    Rule[]
  configurations           Configuration?
  branches                 Branch[]
  specialties              Specialty[]
  users                    User[]
  userSpecialties          UserSpecialty[]
  patients                 Patient[]
  inventoryItems           InventoryItem[]
  inventoryHistory         InventoryHistory[]
  Payroll                  Payroll[]
  SalesDefinition          SalesDefinition[]
  Sales                    Sales[]
  CourseDefinition         CourseDefinition[]
  BankDefinition           BankDefinition[]
  CompanyDefinition        CompanyDefinition[]
  CompanySessionDefinition CompanySessionDefinition[]
  ExpenseTypeDefinition    ExpenseTypeDefinition[]
  Price                    Price[]
  SessionDefinition        SessionDefinition[]
  Expense                  Expense[]
  Revenue                  Revenue[]
}

model User {
  id                  String               @id @default(uuid())
  name                String
  email               String               @unique
  password            String
  organization        Organization         @relation(fields: [organizationId], references: [id])
  organizationId      String
  avatar              String?
  role                PermissionRole?      @relation(fields: [roleId], references: [id])
  roleId              String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now()) @updatedAt
  views               View[]
  viewStatus          ViewStatus[]
  workingHours        WorkingHours[]
  snippets            Snippet[]
  position            Position
  events              Event[]
  user                Appointment[]        @relation("userApp")
  doctor              Appointment[]        @relation("doctorApp")
  inventoryHistory    InventoryHistory[]
  rules               Rule[]
  specialties         UserSpecialty[]
  labDefinitions      LabDefinition[]
  imageDefinitions    ImageDefinition[]
  medicineDefinitions MedicineDefinition[]
  patientReports      PatientReport[]
  patients            Patient[]
  expenses            Expense[]
  revenues            Revenue[]
  inventoryItem       InventoryItem[]
  item                Item[]
  timing              Timing[]
  labCategories       LabCategory[]
  imageCategories     ImageCategory[]
  users               Course[]             @relation("user")
  doctors             Course[]             @relation("doctor")
  BankRevenue         BankRevenue[]
  InsuranceRevenue    InsuranceRevenue[]
  CoursePayment       CoursePayment[]
  PayrollUser         PayrollUser[]
  Sales               Sales[]
  Price               Price[]
  SessionDefinition   SessionDefinition[]
  Hospital            Hospital[]
  Surgery             Surgery[]
  SalesDefinition     SalesDefinition[]
}

model Patient {
  id               String                @id @default(uuid())
  name             String
  phoneNo          String                @unique
  type             PatientMembershipType
  appointments     Appointment[]
  age              Int
  sex              Sex
  reference        Json                  @default("[]")
  area             String                @default("")
  organization     Organization          @relation(fields: [organizationId], references: [id])
  organizationId   String
  user             User                  @relation(fields: [userId], references: [id])
  userId           String
  guardianName     String?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @default(now()) @updatedAt
  medicineHistory  MedicineHistory[]
  familyHistory    FamilyHistory[]
  inventoryHistory InventoryHistory[]
  patientSurgeries PatientSurgery[]
  labs             Lab[]
  images           Image[]
  Course           Course[]
}

model Appointment {
  id               String             @id @default(uuid())
  date             DateTime           @default(now())
  type             AppointmentType
  patient          Patient            @relation(fields: [patientId], references: [id])
  patientId        String
  user             User               @relation("userApp", fields: [userId], references: [id])
  userId           String
  doctor           User               @relation("doctorApp", fields: [doctorId], references: [id])
  doctorId         String
  businessNotes    String             @default("")
  status           AppointmentStatus
  data             AppointmentField[]
  notes            String?            @default("")
  patientSurgeries PatientSurgery[]
  prescription     Prescription[]
  labs             Lab[]
  images           Image[]
  pictures         AppointmentFile[]
  courses          Course[]
  branch           Branch?            @relation(fields: [branchId], references: [id])
  branchId         String?
  specialty        Specialty?         @relation(fields: [specialtyId], references: [id])
  specialtyId      String?
  session          SessionDefinition? @relation(fields: [sessionId], references: [id])
  sessionId        String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now()) @updatedAt
}

model Prescription {
  id            String             @id @default(uuid())
  dose          String?
  medicine      MedicineDefinition @relation(fields: [medicineId], references: [id])
  medicineId    String
  timing        Timing             @relation(fields: [timingId], references: [id])
  timingId      String
  duration      Int?
  period        String?
  appointment   Appointment?       @relation(fields: [appointmentId], references: [id])
  appointmentId String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @default(now()) @updatedAt
}

model View {
  id                  String          @id @default(uuid())
  name                String
  type                AppointmentType @default(Examination)
  user                User            @relation(fields: [userId], references: [id])
  userId              String
  fieldGroups         FieldGroup[]
  activeViewsStatuses ViewStatus[]
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now()) @updatedAt
}

model ViewStatus {
  id           String   @id @default(uuid())
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  activeView   View     @relation(fields: [activeViewId], references: [id])
  activeViewId String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now()) @updatedAt
}

model FieldGroup {
  id        String   @id @default(uuid())
  name      String
  order     Int
  view      View     @relation(fields: [viewId], references: [id])
  viewId    String
  fields    Field[]
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@unique([order, viewId], name: "order_viewId_unique_constraint")
}

model Field {
  id                String             @id @default(uuid())
  name              String
  order             Int
  type              FieldType
  choices           Json
  fieldGroup        FieldGroup?        @relation(fields: [fieldGroupId], references: [id])
  fieldGroupId      String?
  appointmentFields AppointmentField[]
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @default(now()) @updatedAt

  @@unique([order, fieldGroupId], name: "order_fieldGroupId_unique_constraint")
}

model AppointmentField {
  id            String      @id @default(uuid())
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
  appointmentId String
  field         Field       @relation(fields: [fieldId], references: [id])
  fieldId       String
  value         String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @default(now()) @updatedAt

  @@unique([appointmentId, fieldId], name: "appointment_fieldId_unique_constraint")
}

model File {
  id               String            @id @default(uuid())
  url              String
  filename         String
  mimetype         String?
  encoding         String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now()) @updatedAt
  lab              Lab[]
  image            Image[]
  appointmentFiles AppointmentFile[]
}

model AppointmentFile {
  comment       String?
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
  appointmentId String
  file          File        @relation(fields: [fileId], references: [id])
  fileId        String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @default(now()) @updatedAt

  @@id(fileId)
}

model PayrollUser {
  id                           String                         @id @default(uuid())
  user                         User                           @relation(fields: [userId], references: [id])
  userId                       String
  salary                       Int
  organizationId               String
  createdAt                    DateTime                       @default(now())
  updatedAt                    DateTime                       @default(now()) @updatedAt
  transactions                 PayrollTransaction[]
  TransactionCoursesTimeFrame  TransactionCoursesTimeFrame[]
  TransactionRevenuesTimeFrame TransactionRevenuesTimeFrame[]
}

model PayrollTransaction {
  id            String                 @id @default(uuid())
  amount        Int
  reason        String                 @default(" ")
  date          DateTime
  status        String                 @default("on")
  added         Boolean                @default(false)
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @default(now()) @updatedAt
  type          PayrollTransactionType
  payrollUser   PayrollUser?           @relation(fields: [payrollUserId], references: [id])
  payrollUserId String?
  payroll       Payroll                @relation(fields: [payrollId], references: [id])
  payrollId     String
}

model TransactionCoursesTimeFrame {
  id            String      @id @default(uuid())
  date          DateTime
  payrollUser   PayrollUser @relation(fields: [payrollUserId], references: [id])
  payrollUserId String

  @@unique([payrollUserId], name: "payrollUserId_unique_constraint")
}

model TransactionRevenuesTimeFrame {
  id            String      @id @default(uuid())
  date          DateTime
  payrollUser   PayrollUser @relation(fields: [payrollUserId], references: [id])
  payrollUserId String

  @@unique([payrollUserId], name: "payrollUserId Revenues_unique_constraint")
}

model Payroll {
  id             String               @id @default(uuid())
  name           String
  startDate      DateTime
  endDate        DateTime
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @default(now()) @updatedAt
  status         PayrollStatus
  organization   Organization         @relation(fields: [organizationId], references: [id])
  organizationId String
  transactions   PayrollTransaction[]
}

model Configuration {
  id                   String       @id @default(uuid())
  organization         Organization @relation(fields: [organizationId], references: [id])
  organizationId       String
  enableInvoiceCounter Boolean      @default(false)
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @default(now()) @updatedAt

  @@unique([organizationId], name: "organizationId_unique_constraint")
}

model Week {
  id           String         @id @default(uuid())
  weekNo       Int
  year         Int
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @default(now()) @updatedAt
  WorkingHours WorkingHours[]

  @@unique([weekNo, year], name: "week_year_unique_constraint")
}

model WorkingHours {
  id        String   @id @default(uuid())
  week      Week     @relation(fields: [weekId], references: [id])
  weekId    String
  doctor    User     @relation(fields: [doctorId], references: [id])
  doctorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  start     DateTime
  end       DateTime
}

model Snippet {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  title     String   @unique
  body      String
}

model Lab {
  id              String        @id @default(uuid())
  status          LabStatus
  requiredDate    DateTime      @default(now())
  resultDate      DateTime?
  value           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @default(now()) @updatedAt
  patient         Patient       @relation(fields: [patientId], references: [id])
  patientId       String
  labDefinition   LabDefinition @relation(fields: [labDefinitionId], references: [id])
  labDefinitionId String
  appointment     Appointment   @relation(fields: [appointmentId], references: [id])
  appointmentId   String
  documents       File[]
}

model Image {
  id                String          @id @default(uuid())
  status            LabStatus
  requiredDate      DateTime        @default(now())
  resultDate        DateTime?
  value             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @default(now()) @updatedAt
  patient           Patient         @relation(fields: [patientId], references: [id])
  patientId         String
  imageDefinition   ImageDefinition @relation(fields: [imageDefinitionId], references: [id])
  imageDefinitionId String
  appointment       Appointment     @relation(fields: [appointmentId], references: [id])
  appointmentId     String
  documents         File[]
}

model MedicineHistory {
  id           String    @id @default(uuid())
  medicineName String
  frequency    String?
  dose         String?
  fromDate     DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  patient      Patient   @relation(fields: [patientId], references: [id])
  patientId    String
}

model FamilyHistory {
  id        String   @id @default(uuid())
  disease   String
  relative  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  patient   Patient  @relation(fields: [patientId], references: [id])
  patientId String
}

model Expense {
  id             String       @id @default(uuid())
  name           String
  date           DateTime
  amount         Int
  expenseType    String
  invoiceNo      String?
  level          String?
  specialty      Specialty?   @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?      @relation(fields: [branchId], references: [id])
  branchId       String?
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  user           User         @relation(fields: [userId], references: [id])
  userId         String
}

model Revenue {
  id             String       @id @default(uuid())
  name           String
  date           DateTime
  amount         Int
  invoiceNo      String?
  level          String?
  specialty      Specialty?   @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?      @relation(fields: [branchId], references: [id])
  branchId       String?
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  user           User         @relation(fields: [userId], references: [id])
  userId         String
}

model BankRevenue {
  id        String         @id @default(uuid())
  name      String
  date      DateTime
  amount    Int
  invoiceNo String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @default(now()) @updatedAt
  user      User           @relation(fields: [userId], references: [id])
  userId    String
  bank      BankDefinition @relation(fields: [bankId], references: [id])
  bankId    String
}

model InsuranceRevenue {
  id        String            @id @default(uuid())
  name      String
  date      DateTime
  amount    Int
  invoiceNo String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @default(now()) @updatedAt
  user      User              @relation(fields: [userId], references: [id])
  userId    String
  company   CompanyDefinition @relation(fields: [companyId], references: [id])
  companyId String
}

model Notification {
  id         String   @id @default(uuid())
  notifierId String
  userId     String
  type       String
  message    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
  viewed     Boolean  @default(false)
  date       DateTime @default(now())
}

model Event {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  userId    String
  name      String
  start     DateTime
  end       DateTime
}

model Item {
  id               String             @id @default(uuid())
  name             String             @unique
  unitOfMeasure    UnitOfMeaure
  quantity         Int
  barcode          String?
  notes            String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now()) @updatedAt
  organization     Organization       @relation(fields: [organizationId], references: [id])
  organizationId   String
  user             User               @relation(fields: [userId], references: [id])
  userId           String
  inventoryItems   InventoryItem[]
  inventoryHistory InventoryHistory[]
}

model InventoryItem {
  quantity       Int
  item           Item         @relation(fields: [itemId], references: [id])
  itemId         String
  level          String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  user           User         @relation(fields: [userId], references: [id])
  branch         Branch?      @relation(fields: [branchId], references: [id])
  specialty      Specialty?   @relation(fields: [specialtyId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  userId         String
  branchId       String?
  specialtyId    String?

  @@id([itemId, userId])
}

model InventoryHistory {
  id             String             @id @default(uuid())
  item           Item               @relation(fields: [itemId], references: [id])
  itemId         String
  user           User               @relation(fields: [userId], references: [id])
  userId         String
  patient        Patient?           @relation(fields: [patientId], references: [id])
  patientId      String?
  operation      InventoryOperation
  quantity       Int
  price          Int?
  date           DateTime
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @default(now()) @updatedAt
  organization   Organization       @relation(fields: [organizationId], references: [id])
  organizationId String
}

model Hospital {
  id             String           @id @default(uuid())
  name           String
  phoneNo        String?
  address        String?
  level          String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now()) @updatedAt
  user           User             @relation(fields: [userId], references: [id])
  userId         String
  specialty      Specialty?       @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?          @relation(fields: [branchId], references: [id])
  branchId       String?
  organization   Organization     @relation(fields: [organizationId], references: [id])
  organizationId String
  PatientSurgery PatientSurgery[]
}

model LabDefinition {
  id         String      @id @default(uuid())
  name       String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @default(now()) @updatedAt
  category   LabCategory @relation(fields: [categoryId], references: [id])
  categoryId String
  user       User        @relation(fields: [userId], references: [id])
  userId     String
  labs       Lab[]
}

model LabCategory {
  id            String          @id @default(uuid())
  name          String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now()) @updatedAt
  user          User            @relation(fields: [userId], references: [id])
  userId        String
  LabDefinition LabDefinition[]
}

model Timing {
  id                String         @id @default(uuid())
  name              String
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @default(now()) @updatedAt
  englishPrintValue String
  arabicPrintValue  String
  user              User           @relation(fields: [userId], references: [id])
  userId            String
  prescriptions     Prescription[]
}

model ImageDefinition {
  id         String        @id @default(uuid())
  name       String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @default(now()) @updatedAt
  category   ImageCategory @relation(fields: [categoryId], references: [id])
  categoryId String
  user       User          @relation(fields: [userId], references: [id])
  userId     String
  Image      Image[]
}

model Price {
  id             String       @id @default(uuid())
  Apptype        String
  price          Int
  level          String
  user           User         @relation(fields: [userId], references: [id])
  userId         String
  specialty      Specialty?   @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?      @relation(fields: [branchId], references: [id])
  branchId       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
}

model SessionDefinition {
  id             String        @id @default(uuid())
  name           String
  price          Int
  level          String
  user           User          @relation(fields: [userId], references: [id])
  userId         String
  specialty      Specialty?    @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?       @relation(fields: [branchId], references: [id])
  branchId       String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
  organization   Organization  @relation(fields: [organizationId], references: [id])
  organizationId String
  Appointment    Appointment[]
}

model BankDefinition {
  id             String        @id @default(uuid())
  name           String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
  organization   Organization  @relation(fields: [organizationId], references: [id])
  organizationId String
  BankRevenue    BankRevenue[]
}

model ExpenseTypeDefinition {
  id             String       @id @default(uuid())
  name           String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
}

model CompanyDefinition {
  id                       String                     @id @default(uuid())
  name                     String
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now()) @updatedAt
  organization             Organization               @relation(fields: [organizationId], references: [id])
  organizationId           String
  CompanySessionDefinition CompanySessionDefinition[]
  InsuranceRevenue         InsuranceRevenue[]
}

model CompanySessionDefinition {
  id             String            @id @default(uuid())
  name           String
  price          Int
  company        CompanyDefinition @relation(fields: [companyId], references: [id])
  companyId      String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now()) @updatedAt
  organization   Organization      @relation(fields: [organizationId], references: [id])
  organizationId String
}

model SalesDefinition {
  id             String       @id @default(uuid())
  name           String
  price          Int
  cost           Int
  totalQuantity  Int          @default(0)
  level          String
  user           User?        @relation(fields: [userId], references: [id])
  userId         String?
  specialty      Specialty?   @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?      @relation(fields: [branchId], references: [id])
  branchId       String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  Sales          Sales[]
}

model Sales {
  id                String          @id @default(uuid())
  quantity          Int
  totalPrice        Int
  totalCost         Int
  date              DateTime
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @default(now()) @updatedAt
  organization      Organization    @relation(fields: [organizationId], references: [id])
  organizationId    String
  user              User            @relation(fields: [userId], references: [id])
  userId            String
  salesDefinition   SalesDefinition @relation(fields: [salesDefinitionId], references: [id])
  salesDefinitionId String

}

model CourseDefinition {
  id             String       @id @default(uuid())
  name           String
  type           CourseType
  price          Int
  units          Int
  messureOfUnits String
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
  Course         Course[]
}

model Course {
  id                 String           @id @default(uuid())
  price              Int
  paid               Int
  consumed           Int              @default(0)
  discount           Int
  startDate          DateTime
  endDate            DateTime
  status             CourseStatus
  sessions           Appointment[]
  patient            Patient          @relation(fields: [patientId], references: [id])
  patientId          String
  user               User             @relation("user", fields: [userId], references: [id])
  userId             String
  courseDefinition   CourseDefinition @relation(fields: [courseDefinitionId], references: [id])
  courseDefinitionId String
  doctor             User             @relation("doctor", fields: [doctorId], references: [id])
  doctorId           String
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @default(now()) @updatedAt
  CoursePayment      CoursePayment[]
}

model CoursePayment {
  id       String   @id @default(uuid())
  payment  Int
  date     DateTime
  user     User     @relation(fields: [userId], references: [id])
  userId   String
  course   Course   @relation(fields: [courseId], references: [id])
  courseId String
}

model ImageCategory {
  id              String            @id @default(uuid())
  name            String
  user            User              @relation(fields: [userId], references: [id])
  userId          String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now()) @updatedAt
  ImageDefinition ImageDefinition[]
}

model MedicineDefinition {
  id            String         @id @default(uuid())
  name          String
  concentration String
  form          String
  user          User           @relation(fields: [userId], references: [id])
  userId        String
  prescriptions Prescription[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now()) @updatedAt
}

model PatientReport {
  id        String   @id @default(uuid())
  name      String
  body      String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Surgery {
  id             String           @id @default(uuid())
  name           String
  level          String
  user           User             @relation(fields: [userId], references: [id])
  userId         String
  specialty      Specialty?       @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  branch         Branch?          @relation(fields: [branchId], references: [id])
  branchId       String?
  organization   Organization     @relation(fields: [organizationId], references: [id])
  organizationId String
  patientSurgery PatientSurgery[]
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now()) @updatedAt
}

model PatientSurgery {
  id             String       @id @default(uuid())
  patient        Patient      @relation(fields: [patientId], references: [id])
  patientId      String
  surgery        Surgery      @relation(fields: [surgeryId], references: [id])
  surgeryId      String
  hospital       Hospital     @relation(fields: [hospitalId], references: [id])
  hospitalId     String
  appointment    Appointment? @relation(fields: [appointmentId], references: [id])
  appointmentId  String?
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  date           DateTime
  fees           Int?
  hospitalFees   Int?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
}

// permissions

enum PermissionLevel {
  Organization
  Branch
  Specialty
  User
}

model PermissionRole {
  id             String       @id @default(uuid())
  name           String
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  permissions    Permission[]
  users          User[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
}

model Permission {
  id             String           @id @default(uuid())
  all            Boolean          @default(false)
  role           PermissionRole   @relation(fields: [roleId], references: [id])
  roleId         String
  action         PermissionAction
  level          PermissionLevel
  rules          Rule[]
  organization   Organization     @relation(fields: [organizationId], references: [id])
  organizationId String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now()) @updatedAt

  @@unique([action, roleId], name: "action_roleId_unique_constraint")
}

model Rule {
  id             String       @id @default(uuid())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  branch         Branch?      @relation(fields: [branchId], references: [id])
  branchId       String?
  specialty      Specialty?   @relation(fields: [specialtyId], references: [id])
  specialtyId    String?
  user           User?        @relation(fields: [userId], references: [id])
  userId         String?
  permission     Permission   @relation(fields: [permissionId], references: [id])
  permissionId   String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
}

model Branch {
  id                String              @id @default(uuid())
  name              String
  address           String?
  phoneNo           String?
  notes             String?
  organization      Organization        @relation(fields: [organizationId], references: [id])
  organizationId    String
  rules             Rule[]
  specialties       Specialty[]
  userSpecialties   UserSpecialty[]
  Appointment       Appointment[]
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now()) @updatedAt
  InventoryItem     InventoryItem[]
  Price             Price[]
  SessionDefinition SessionDefinition[]
  Hospital          Hospital[]
  Surgery           Surgery[]
  Revenue           Revenue[]
  Expense           Expense[]
  SalesDefinition   SalesDefinition[]
}

model Specialty {
  id                String              @id @default(uuid())
  name              String
  organization      Organization        @relation(fields: [organizationId], references: [id])
  organizationId    String
  rules             Rule[]
  branches          Branch[]
  userSpecialties   UserSpecialty[]
  Appointment       Appointment[]
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now()) @updatedAt
  InventoryItem     InventoryItem[]
  Price             Price[]
  SessionDefinition SessionDefinition[]
  Hospital          Hospital[]
  Surgery           Surgery[]
  Revenue           Revenue[]
  Expense           Expense[]
  SalesDefinition   SalesDefinition[]
}

model UserSpecialty {
  id             String       @id @default(uuid())
  branch         Branch       @relation(fields: [branchId], references: [id])
  branchId       String
  specialty      Specialty    @relation(fields: [specialtyId], references: [id])
  specialtyId    String
  user           User         @relation(fields: [userId], references: [id])
  userId         String
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt

  @@unique([userId, branchId], name: "userId_branchId_unique_constraint")
}

// end permission
